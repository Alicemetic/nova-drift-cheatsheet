<!DOCTYPE html>
<html>
<head>

	<meta property="og:type" content="article" />
	<meta property="og:locale" content="ja_JP" />
	<meta property="og:site_name" content="Nova Drift cheatsheet" />
	<meta property="og:title" content="Nova Drift cheatsheet" />
	<meta property="og:url" content="https://alicemetic.github.io/nova-drift-cheatsheet/" />
	<meta property="twitter:url" content="https://alicemetic.github.io/nova-drift-cheatsheet/" />
	<meta property="og:description" content="Nova Drift ビルド共有ツール" />
	<meta property="twitter:description" content="Nova Drift ビルド共有ツール" />
	<meta property="twitter:card" content="summary_large_image" />
	<meta property="og:image" content="og.png" />
	<meta property="og:image:width" content="1024" />
	<meta property="og:image:height" content="600" />
	<meta property="twitter:image" content="og.png" />
	<meta property="twitter:image:width" content="1024" />
	<meta property="twitter:image:height" content="600" />

	<link rel="shortcut icon" type="image/x-icon" href="favicon.ico?">

	<meta charset="utf-8"/>
	<link rel="stylesheet" href="hex.css?v=<!--lastupdateHex-->"/>
	<link rel="stylesheet" href="style.css?v=<!--lastupdateStyle-->"/>
	<title>Nova Drift Cheatsheet</title>
</head>
<body>
	<style id="match-style"></style>
	<article id="intro">
		<div>
			<span class="langswitch">
				<input type="button" value="English" id="langswitch-en" />
				<input type="button" value="Japanese" id="langswitch-ja"/>
			</span>
			<span class="content-en">Cheatsheet made by <a href="https://yal.cc">YellowAfterlife</a>!</span>
			<span class="content-ja"><a href="https://yal.cc">YellowAfterlife</a> 氏による Nova Drift 向けチートシートです。</span>
		</div>
		<div class="content-en">Last Update: <!--lastupdate--></div>
		<div class="content-ja">最終更新: <!--lastupdate--></div>
		<br>
		<noscript><style>
		#js-controls {
			display: none;
		}
		</style>Some additional options are only available with JavaScript enabled.</noscript>
		<section id="js-controls">
			<span class="content-en">Active brightness:</span>
			<span class="content-ja">選択中項目の明るさ</span>
			<input type="range" min="0" max="200" value="125" id="active-brightness" /><br/>

			<span class="content-en">Inactive brightness:</span>
			<span class="content-ja">非選択項目の明るさ</span>
			<input type="range" min="0" max="200" value="50" id="inactive-brightness" /><br/>

			<input type="button" value="Reset" id="reset-selection" />
			<input type="button" value="Copy Link" id="copy-link" title="Share or Save your build with URL!" />
			Count: <span id="hex-select-count">0</span>
		</section>
	</article>
	<section id="mods">
		<header class="content-en">Weapons</header>
		<header class="content-ja">武器</header>
		<section class="content-en"><!--weapons--></section>
		<section class="content-ja"><!--weaponsJP--></section>
		<header class="content-en">Bodies</header>
		<header class="content-ja">ボディ</header>
		<section class="content-en"><!--bodies--></section>
		<section class="content-ja"><!--bodiesJP--></section>
		<header class="content-en">Shields</header>
		<header class="content-ja">シールド</header>
		<section class="content-en"><!--shields--></section>
		<section class="content-ja"><!--shieldsJP--></section>
		<header class="content-en">Mod Trees</header>
		<header class="content-ja">通常MOD</header>
		<section class="content-en"><!--branches--></section>
		<section class="content-ja"><!--branchesJP--></section>
		<header class="content-en">Super Mods</header>
		<header class="content-ja">スーパーMOD</header>
		<section class="content-en"><!--supers--></section>
		<section class="content-ja"><!--supersJP--></section>
		<header class="content-en">Wild Mods</header>
		<header class="content-ja">不可測MOD</header>
		<section class="content-en"><!--wildCommon--></section>
		<section class="content-en"><!--wildRare--></section>
		<section class="content-en"><!--wildUltraRare--></section>
		<section class="content-ja"><!--wildCommonJP--></section>
		<section class="content-ja"><!--wildRareJP--></section>
		<section class="content-ja"><!--wildUltraRareJP--></section>
	</section>
	<script src="https://unpkg.com/@popperjs/core@2"></script>
	<script src="https://unpkg.com/tippy.js@6"></script>
	<script src="script.js"></script>
	<script>(function() {
	var style = document.getElementById("match-style");

	var cssActive = " { filter: brightness(125%) }";
	var activeSlider = document.getElementById("active-brightness");
	var keyActive = "nova-drift-sheet:active-brightness";
	function syncActiveBrightness() {
		cssActive = ' { filter: brightness(' + activeSlider.value + '%) }';
	}
	activeSlider.addEventListener("change", function(_) {
		syncActiveBrightness();
		localStorage.setItem(keyActive, activeSlider.value);
	});
	if (localStorage.getItem(keyActive)) {
		activeSlider.value = 0|localStorage.getItem(keyActive);
		syncActiveBrightness();
	}

	var cssInactive = " { filter: brightness(50%) }";
	var inactiveSlider = document.getElementById("inactive-brightness");
	var keyInactive = "nova-drift-sheet:inactive-brightness";
	function syncInactiveBrightness() {
		cssInactive = ' { filter: brightness(' + inactiveSlider.value + '%) }';
	}
	inactiveSlider.addEventListener("change", function() {
		syncInactiveBrightness();
		localStorage.setItem(keyInactive, inactiveSlider.value);
	});
	if (localStorage.getItem(keyInactive)) {
		inactiveSlider.value = 0|localStorage.getItem(keyInactive);
		syncInactiveBrightness();
	}

	function onModEnter(e) {
		var hex = e.target;
		var name = hex.getAttribute("data-hex-name");
		if (!name) return;
		var css = [];
		// if (!hex.parentElement.classList.contains("single")) {
		css.push(".hex:not(." + name + ")" + cssInactive);
		css.push(".hex." + name + cssActive);
		// }
		style.innerHTML = css.join("\n");
	}

	function onMaxEnter(e) {
		var hex = e.target;
		var name = hex.getAttribute("data-hex-name");
		var constructMax = 	[ "Retribution",
							  "Fleet",
							  "Flotilla",
							  "CounterArtillery",
							  "MediCharge",
							  "Overpower",
							  "Overseer",
							  "SupportSpecialist",
							  "Max"
							];
		if (!name) return;

		var css = [];
		var inactiveList = ".hex";
		var activeList = "";

		for( var i = 0; i < constructMax.length; i++ )
		{
			inactiveList = inactiveList + ":not(." + constructMax[i] + ")";
			if(i == 0)
				activeList = activeList + ".hex." + constructMax[i];
			else
				activeList = activeList + ",.hex." + constructMax[i];
		}

		css.push(inactiveList + cssInactive);
		css.push(activeList + cssActive);

		style.innerHTML = css.join("\n");
	}

	var modShorten = Object.create(null);
	var modLongen = Object.create(null);
	var modSlPairs = "[[shorten_data]]".split(";");
	for (var i = 0; i < modSlPairs.length; i++) {
		var pair = modSlPairs[i];
		var sep = pair.indexOf("=");
		var sh = pair.substring(0, sep);
		var lg = pair.substring(sep + 1);
		modShorten[lg] = sh;
		modLongen[sh] = lg;
	}

	var hexFilter = document.getElementById("hex-filter");
	var hexCheckCount = 0;
	var hexCheckCountSpan = document.getElementById("hex-select-count");
	var hexFilterUpdate;
	function clearMatch(e) {
		if (document.activeElement == hexFilter) {
			hexFilterUpdate(true);
		} else if (hexCheckCount > 0) {
			style.innerHTML = [
				'.hex:not([checked]) ' + cssInactive,
				'.hex[checked] ' + cssActive,
			].join("\n");
		} else style.innerHTML = "";
	}
	document.getElementById("reset-selection").addEventListener("click", function(_) {
		var els = document.querySelectorAll(".hex[checked]");
		for (var i = 0; i < els.length; i++) els[i].removeAttribute("checked");
		hexCheckCount = 0;
		hexCheckCountSpan.innerHTML = "0";
		clearMatch();
	});
	document.getElementById("copy-link").addEventListener("click", function(_) {
		var els = document.querySelectorAll(".hex[checked]");
		var arr = [], found = Object.create(null);
		for (var i = 0; i < els.length; i++) {
			var mod = els[i].getAttribute("data-hex-name");
			if (found[mod]) continue; else found[mod] = true;
			arr.push(modShorten[mod] || mod);
		}
		var href = location.href;
		var sep = href.indexOf("?");
		var sep2 = href.indexOf("#");
		if (sep < 0 || sep2 >= 0 && sep2 < sep) sep = sep2;
		if (sep >= 0) href = href.substring(0, sep);
		if (arr.length > 0) href += "?mods=" + arr.join("+");
		prompt("Copy your link:", href);
	});

	document.getElementById("langswitch-ja").addEventListener("click", function(_)
	{
		document.getElementsByTagName('html')[0].className = "ja";
	});

	document.getElementById("langswitch-en").addEventListener("click", function(_)
	{
		document.getElementsByTagName('html')[0].className = "en";
	});
	function onHexToggle(e) {
		var hex = e.target;
		var els = document.querySelectorAll(".hex." + hex.getAttribute("data-hex-name"));
		if (hex.hasAttribute("checked")) {
			for (var i = 0; i < els.length; i++) els[i].removeAttribute("checked");
			if (--hexCheckCount == 0) clearMatch();
		} else {
			for (var i = 0; i < els.length; i++) els[i].setAttribute("checked", "");
			if (++hexCheckCount == 1) clearMatch();
		}
		hexCheckCountSpan.innerHTML = "" + hexCheckCount;
	}
	var hexagons = document.getElementsByClassName("hex");
	for (var i = 0; i < hexagons.length; i++) {
		var hex = hexagons[i];
		for (var k = 0; k < hex.classList.length; k++) {
			if (hex.classList[k] == "hex") continue;
			hex.setAttribute("data-hex-name", hex.classList[k]);
			break;
		}
		if( hex.classList[k] == "Max" )
			hex.addEventListener("mouseenter", onMaxEnter);
		else
			hex.addEventListener("mouseenter", onModEnter);

		hex.addEventListener("mouseleave", clearMatch);
		hex.addEventListener("click", onHexToggle);
	}

	if (location.search.charAt(0) == "?") {
		var args = location.search.substring(1).split("&");
		for (var i = 0; i < args.length; i++) {
			var pair = args[i], key, val;
			var sep = pair.indexOf("=");
			if (sep >= 0) {
				key = pair.substr(0, sep);
				val = pair.substr(sep + 1);
			} else { key = pair; val = ""; }
			if (key == "mods") {
				var modArr = val.split("+");
				for (var i = 0; i < modArr.length; i++) try{
					var mod = modArr[i];
					var els = document.querySelectorAll(".hex." + (modLongen[mod] || mod));
					if (els.length == 0) continue;
					for (var k = 0; k < els.length; k++) els[k].setAttribute("checked", "");
					hexCheckCount++;
				} catch (e) { console.log(e); }
				hexCheckCountSpan.innerHTML = "" + hexCheckCount;
				clearMatch();
				break;
			}
		}
	}

	function onTagEnter(e) {
		var tag = e.target;
		var name = tag.innerText || tag.textContent;
		style.innerHTML = [
			'.hex:not([data-hex-tags*="' + name + ';"]) ' + cssInactive,
			'.hex[data-hex-tags*="' + name + ';"] ' + cssActive,
		].join("\n");
	}
	var hextags = document.getElementsByClassName("hextag");
	for (var i = 0; i < hextags.length; i++) {
		var tag = hextags[i];
		tag.addEventListener("mouseenter", onTagEnter);
		tag.addEventListener("mouseleave", clearMatch);
	}

	var hexFilterValue = null;
	hexFilterUpdate = function(force) {
		var val = hexFilter.value;
		if (!force && val == hexFilterValue) return;
		hexFilterValue = val;

		var words = val.split(" ");
		var wordsOr = [];
		var wordsAnd = [];
		var wordsNot = [];
		for (var i = 0; i < words.length; i++) {
			var word = words[i];
			if (!word) continue;
			word = word.toLowerCase();
			if (word.charAt(0) == "-") {
				wordsNot.push(word.substr(1));
			} else if (word.charAt(0) == "+") {
				wordsAnd.push(word.substr(1));
			} else {
				var wordParts = word.split("+");
				wordsOr.push(wordParts[0]);
				for (var k = 1; k < wordParts.length; k++) {
					wordsAnd.push(wordParts[k]);
				}
			}
		}
		var cssLines = ['.hex ' + cssInactive];
		for (var i = 0; i < wordsOr.length; i++) {
			var cssLine = '.hex[data-hex-text*="' + wordsOr[i] + '"]';
			for (var k = 0; k < wordsAnd.length; k++) {
				cssLine += '[data-hex-text*="' + wordsAnd[k] + '"]';
			}
			for (var k = 0; k < wordsNot.length; k++) {
				cssLine += ':not([data-hex-text*="' + wordsNot[k] + '"])';
			}
			cssLine += cssActive;
			cssLines.push(cssLine);
		}
		style.innerHTML = cssLines.join("\n");
	}
	hexFilter.addEventListener("focus", hexFilterUpdate);
	hexFilter.addEventListener("keydown", hexFilterUpdate);
	hexFilter.addEventListener("keyup", hexFilterUpdate);
	hexFilter.addEventListener("blur", function() {
		style.innerHTML = "";
		hexFilterValue = null;
	});

	})();
	var _gaq = _gaq||[];_gaq.push(['_setAccount','UA-36439133-1']);_gaq.push(['_trackPageview']);
	</script>
	<script>
		function NavigatorGetLanguage()
		{
			var navigator_obj = window.navigator;
			if(navigator_obj.language !== undefined)
				return navigator_obj.language;
			if(navigator_obj.browserLanguage !== undefined)
				return navigator_obj.browserLanguage;
			if(navigator_obj.userLanguage !== undefined)
				return navigator_obj.userLanguage;
			return "en";
		}

		var language = NavigatorGetLanguage();

		// Currently supported: en, ja
		if( (language == "en") ||
		    (language == "ja") )
		{
			document.getElementsByTagName('html')[0].className = language;
		}
		else
		{
			document.getElementsByTagName('html')[0].className = "en";
		}
	</script>
	<script type="text/javascript" async="true" src="https://www.google-analytics.com/ga.js"></script>
</body>
</html>